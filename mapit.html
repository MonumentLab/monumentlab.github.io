---
layout: mapit
title: Mapit
permalink: /mapit
---

<div id='map'></div>

<script src="assets/js/proposals.js" type="text/javascript"></script>
<script src="assets/js/neighborhoods.js" type="text/javascript"></script>
<script>
	var map = L.map('map').setView([39.93, -75.13], 11);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.light'
	}).addTo(map);

  //neighborhoods layer
  var neighborhoodsStyle = {"color": "#ff6a39", "opacity": 0.8, "fillOpacity": 0.45, "weight": 1};
  var neighborhoodsLayer = L.geoJson(neighborhoods, {style: neighborhoodsStyle}).addTo(map);
  map.fitBounds(neighborhoodsLayer.getBounds(), {padding: [10, 10]});
  //remove the neighborhoods layer when the user zooms in past a certain point
  map.on('zoomend', function() {
      if (map.getZoom() > 14){
          if (map.hasLayer(neighborhoodsLayer)) {
              map.removeLayer(neighborhoodsLayer);
          }
      }
      if (map.getZoom() <= 14){
          if (map.hasLayer(neighborhoodsLayer)){
          //   console.log("layer already added");
          }
          else {
              neighborhoodsLayer.addTo(map);
              neighborhoodsLayer.bringToBack();
          }
      }
  });



// proposals

	L.geoJSON(proposals, {

		style: function (feature) {
			return feature.properties && feature.properties.style;
		},

		onEachFeature: onEachFeature,

		pointToLayer: function (feature, latlng) {
			return L.circleMarker(latlng, {
				radius: 8,
				fillColor: "#ff7800",
				color: "#000",
				weight: 1,
				opacity: 1,
				fillOpacity: 0.8
			});
		}
	}).addTo(map);


  function onEachFeature(feature, layer) {
      var html = "<a href='../plugins/leaflet_rs/pages/direct_view.php?ID=" + feature.properties.researchID +
          "'><img src='../filestore/" + feature.properties.path.substring(44) + "'" + "&size=thm' width=100 height=80 ></a>";
      var agePopup = "", zipcodePopup = "", socialMediaPopup = "";
      if (feature.properties && feature.properties.name && feature.properties.ref) {
          if (feature.properties.age){
              var agePopup =  "<b>"+"AGE: "+"</b>" + feature.properties.age + "<br/>";
          }
          if (feature.properties.topicArray) {
              var topic = feature.properties.topicArray + "<br/";
          }
          if (feature.properties.typeArray) {
              var type = feature.properties.typeArray + "<br/";
          }
          if (feature.properties.zipcode){
              var zipcodePopup =  "<b>"+"ZIPCODE: "+"</b>" + feature.properties.zipcode + "<br/>";
          }
          if (feature.properties.twitter) {
              socialMediaPopup = socialMediaPopup + "<a href='https://twitter.com/" + feature.properties.twitter +
              "'><img class='social_icon' src ='../plugins/leaflet_rs/assets/Twitter_Social_Icon_Circle_White.png'></a>";
          }
          if (feature.properties.instagram) {
              socialMediaPopup = socialMediaPopup + "<a href='https://www.instagram.com/" + feature.properties.instagram +
              "'><img class='social_icon' src ='../plugins/leaflet_rs/assets/white_glyph-logo_May2016.png'></a>";
          }
          if (feature.properties.facebook) {
              socialMediaPopup = socialMediaPopup + "<a href='https://facebook.com/" + feature.properties.facebook +
              "'><img class='social_icon' src ='../plugins/leaflet_rs/assets/FB-f-Logo__white_29.png'></a>";
          }
          layer.bindPopup("<span style='font-family:sans-serif; font-size: 14px; letter-spacing:1px'><b>TITLE: </b>" + feature.properties.name + "<br />" +
               type + topic + agePopup + zipcodePopup + "</span>" + "<br />" + html + "<br />"  + socialMediaPopup + "<br />", {autoClose: false});

          //mouseover popups with momument title
          layer.on('mouseover', function(e) {
              //open popup;
              var popup = L.popup()
              .setLatLng(e.latlng)
              .setContent("<div style = 'font-family:sans-serif; letter-spacing:1px; font-weight:bold';>" + feature.properties.name + "</div>")
              .openOn(map);
          });
      }
  };

</script>
